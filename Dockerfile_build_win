ARG MYAPP_IMAGE
#FROM $MYAPP_IMAGE as build-stage
#ARG MYAPP_IMAGE=probe-compile-16 
FROM $MYAPP_IMAGE as build-stage

ARG CONAN_LOGIN_USERNAME
ARG CONAN_PASSWORD
ARG VTS_EXTERNALS_LOCAL_REPOSITORY
ARG VTS_EXTERNALS_WORKING_COPY
ARG BUILDER_USER
ARG BUILDER_PASSWORD
ARG GIT_USERNAME
ARG GIT_PASSWORD
ARG NAME_PROJECT
ARG VERSION_PROJECT
ARG TYPE_BUILD
ARG PUBLISH
ARG NAMESPACE=project1
ARG GITSSHKEY
ARG STF_BUILD_IMAGE_PATH
ARG HOME_DIRECTORY
ARG PACKAGE_DIRECTORY

ENV CONAN_LOGIN_USERNAME=$CONAN_LOGIN_USERNAME
ENV CONAN_PASSWORD=$CONAN_PASSWORD
ENV VTS_EXTERNALS_LOCAL_REPOSITORY=$VTS_EXTERNALS_LOCAL_REPOSITORY
ENV VTS_EXTERNALS_WORKING_COPY=$VTS_EXTERNALS_WORKING_COPY
ENV BUILDER_USER=$BUILDER_USER
ENV BUILDER_PASSWORD=$BUILDER_PASSWORD
ENV GIT_USERNAME=$GIT_USERNAME
ENV GIT_PASSWORD=$GIT_PASSWORD
ENV NAME_PROJECT=$NAME_PROJECT
ENV VERSION_PROJECT=$VERSION_PROJECT
ENV TYPE_BUILD=$TYPE_BUILD
ENV PUBLISH=$PUBLISH
ENV NAMESPACE=$NAMESPACE
ENV GITSSHKEY=$GITSSHKEY
ENV STF_BUILD_IMAGE_PATH=$STF_BUILD_IMAGE_PATH
ENV HOME_DIRECTORY=$HOME_DIRECTORY
ENV PACKAGE_DIRECTORY=$PACKAGE_DIRECTORY

WORKDIR ${HOME_DIRECTORY}/${NAME_PROJECT}
COPY . .
WORKDIR ${HOME_DIRECTORY}/.ssh/

COPY ./id_rsa .
#RUN echo "$GITSSHKEY" > ${HOME_DIRECTORY}/.ssh/id_rsa && \
#    chmod 700 ${HOME_DIRECTORY}/.ssh/id_rsa 

WORKDIR ${HOME_DIRECTORY}

COPY ./build.ps1 .
RUN ./build.ps1
